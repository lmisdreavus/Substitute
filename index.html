<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <style>
        #suggestions {
            margin-top: -1px;
            border-width: 1px;
            border-style: solid;
            border-color: #ddd #ddd transparent transparent;
            position: absolute;
            background-color: white;
            cursor: pointer;
        }
        .suggest-items {
            padding: 10px;
            font-size: 18px;
            border-top: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-5 mb-5">Pokemon Search</h1>
        <form id="search-form" class="form-inline mb-5">
            <input id="search-input" class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
        <div id="suggestions"></div>
        <div id="result"></div>
    </div>
    <script>
        var searchForm = document.getElementById('search-form');
        var searchInput = document.getElementById('search-input');
        var suggestions = document.getElementById('suggestions');
        var result = document.getElementById('result');

        // load data
        var allData = {};
        ['pokemon', 'move', 'ability'].forEach(function(category) {
            fetch(category + '.json')
                .then(response => response.json())
                .then(data => allData[category] = data);
        });

        searchForm.onsubmit = function(event) {
            event.preventDefault();
            // clear previous result
            result.innerHTML = '';

            var input = searchInput.value;
            ['pokemon', 'move', 'ability'].forEach(function(category) {
                allData[category].forEach(function(data) {
                    if (data.name.includes(input)) {
                        // create a new result item
                        var item = document.createElement('div');

                        // create a description if present
                        if (data["설명"]) {
                            var desc = document.createElement("p");
                            desc.textContent = data["설명"];
                            item.appendChild(desc);
                        }
                        
                        var table = document.createElement('table');
                        var tbody = document.createElement('tbody');
                        table.className = 'table table-bordered';
                        
                        for (var key in data) {
                            var tr = document.createElement('tr');
                            var th = document.createElement('th');
                            var td = document.createElement('td');
                            th.textContent = key;
                            td.textContent = data[key];
                            tr.appendChild(th);
                            tr.appendChild(td);
                            tbody.appendChild(tr);
                        }
                        table.appendChild(tbody);
                        item.appendChild(table);

                        result.appendChild(item);
                    }
                });
            });
            // clear input
            searchInput.value = '';
            // clear suggestions
            clearSuggestions();
        };

        searchInput.oninput = function(event) {
            // clear previous suggestions
            clearSuggestions();

            var input = searchInput.value;
            if (input.length > 0) {
                ['pokemon', 'move', 'ability'].forEach(function(category) {
                    allData[category].forEach(function(data) {
                        if (data.name.includes(input)) {
                            var div = document.createElement('div');
                            div.textContent = data.name;
                            div.className = 'suggest-items';
                            div.onclick = function(event) {
                                searchInput.value = div.textContent;
                                searchForm.onsubmit(event);
                            };
                            suggestions.appendChild(div);
                        }
                    });
                });
            }
        };

        function clearSuggestions() {
            suggestions.innerHTML = '';
        }
    </script>
</body>
</html>
