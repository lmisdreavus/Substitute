<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <title>Pokemon Info</title>
</head>
<body>
    <div class="container">
        <h1 class="mt-5">Pokemon 검색기</h1>
        <form class="mt-4" id="search-form" onsubmit="return false;">
            <div class="input-group">
                <input type="text" id="search" class="form-control" onkeyup="showSuggestions(event)" placeholder="Search...">
                <div class="input-group-append">
                    <button class="btn btn-outline-secondary" type="button" onclick="search()">Search</button>
                </div>
            </div>
            <div id="suggestions" class="list-group mt-2"></div>
        </form>
        <div class="mt-5" id="result"></div>
    </div>

    <script>
        var databases = {
            "pokemon": null,
            "move": null,
            "ability": null
        };

        // 각각의 json 파일에서 데이터를 불러옵니다.
        fetch('pokemon.json')
            .then(response => response.json())
            .then(data => { databases.pokemon = data; });

        fetch('move.json')
            .then(response => response.json())
            .then(data => { databases.move = data; });

        fetch('ability.json')
            .then(response => response.json())
            .then(data => { databases.ability = data; });

        // 사용자가 입력하는 글자에 따라 제안된 검색어를 보여줍니다.
        function showSuggestions(event) {
            var input = document.getElementById("search").value.toLowerCase();
            var suggestions = document.getElementById("suggestions");

            // Enter 키가 눌렸을 때 제안 목록을 지우고 검색합니다.
            if (event.key === 'Enter') {
                suggestions.innerHTML = '';
                search();
                event.preventDefault();  // 폼 제출을 방지합니다.
                return;
            }

            // 제안 목록을 초기화합니다.
            while(suggestions.firstChild) {
                suggestions.removeChild(suggestions.firstChild);
            }

            // 각각의 데이터베이스에서 검색어와 일치하는 항목을 찾아 제안 목록에 추가합니다.
            for(var category in databases) {
                var database = databases[category];

                if(database) {
                    for(var name in database) {
                        if(name.toLowerCase().startsWith(input) && input !== '') {
                            var div = document.createElement("div");
                            div.textContent = name;
                            div.setAttribute("class", "list-group-item list-group-item-action");
                            div.addEventListener("click", function() {
                                document.getElementById("search").value = this.textContent;
                                search();
                                suggestions.innerHTML = '';
                            });
                            suggestions.appendChild(div);
                        }
                    }
                }
            }
        }

        // 사용자가 입력한 검색어에 해당하는 결과를 보여줍니다.
        function search() {
            var input = document.getElementById("search").value.toLowerCase();
            var result = document.getElementById("result");

            // 결과를 초기화합니다.
            while(result.firstChild) {
                result.removeChild(result.firstChild);
            }

            // 각각의 데이터베이스에서 검색어와 일치하는 항목을 찾아 결과에 추가합니다.
            for(var category in databases) {
                var database = databases[category];

                if(database) {
                    var data = database[input];
                    if(data) {
                        // 'pokemon' 카테고리에 대해서는 표를 생성합니다.
                        if (category === 'pokemon') {
                            var table = document.createElement('table');
                            table.className = 'table table-striped';

                            var trHead = document.createElement('tr');
                            var trData = document.createElement('tr');

                            for(var key in data) {
                                var th = document.createElement('th');
                                th.textContent = key;
                                trHead.appendChild(th);

                                var td = document.createElement('td');
                                td.textContent = data[key];
                                trData.appendChild(td);
                            }

                            table.appendChild(trHead);
                            table.appendChild(trData);
                            result.appendChild(table);
                        }
                        // 그 외 카테고리에 대해서는 텍스트를 생성합니다.
                        else {
                            for(var key in data) {
                                var p = document.createElement("p");
                                p.textContent = key + " : " + data[key];
                                result.appendChild(p);
                            }
                        }
                    }
                }
            }
        }

    </script>
</body>
</html>
