<!DOCTYPE html>
<html>
<head>
    <title>포켓몬 검색</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <style>
        #suggestions {
            position: absolute;
            width: 100%;
            z-index: 100;
            top: 38px;  /* Adjust this value as needed */
        }
    </style>
</head>
<body class="container pt-4">
    <h1 class="text-center mb-4">포켓몬 검색</h1>

    <div class="input-group position-relative mb-3">
        <form id="searchForm" class="input-group">
            <select id="category" class="custom-select">
                <option value="pokemon">포켓몬</option>
                <option value="move">기술</option>
                <option value="ability">특성</option>
            </select>
            <input type="text" id="search" class="form-control" placeholder="검색어를 입력하세요" onkeyup="showSuggestions()">
            <div class="input-group-append">
                <button type="submit" class="btn btn-outline-secondary">검색</button>
            </div>
        </form>
        <div id="suggestions" class="list-group"></div>
    </div>

    <div id="result" class="p-3 border rounded"></div>

    <script>
        var databases = {
            'pokemon': null,
            'move': null,
            'ability': null
        };

        fetch('./pokemon.json')
            .then(response => response.json())
            .then(data => databases['pokemon'] = data)
            .catch(error => console.error('Error:', error));

        fetch('./move.json')
            .then(response => response.json())
            .then(data => databases['move'] = data)
            .catch(error => console.error('Error:', error));

        fetch('./ability.json')
            .then(response => response.json())
            .then(data => databases['ability'] = data)
            .catch(error => console.error('Error:', error));

        function search(event) {
            event.preventDefault();
            var searchName = document.getElementById("search").value;
            var category = document.getElementById("category").value;
            var resultDiv = document.getElementById("result");

            resultDiv.innerHTML = '';  // Clear any existing results

            var database = databases[category];

            if(database && database[searchName]) {
                resultDiv.innerText = category + " : " + searchName;

                for(var key in database[searchName]) {
                    resultDiv.innerHTML += `<p>${key} : ${database[searchName][key]}</p>`;
                }
            } else {
                alert("해당하는 정보를 찾을 수 없습니다.");
            }

            document.getElementById('suggestions').innerHTML = '';
        }

        function showSuggestions() {
            var input = document.getElementById("search").value.toLowerCase();
            var category = document.getElementById("category").value;
            var suggestions = document.getElementById("suggestions");
            var database = databases[category];

            // Clear any existing suggestions
            while(suggestions.firstChild) {
                suggestions.removeChild(suggestions.firstChild);
            }

            if(database) {
                for(var name in database) {
                    if(name.toLowerCase().startsWith(input) && input !== '') {
                        var div = document.createElement("div");
                        div.textContent = name;
                        div.setAttribute("class", "list-group-item list-group-item-action");
                        div.addEventListener("click", function() {
                            document.getElementById("search").value = this.textContent;
                            search(new Event('submit'));
                        });
                        suggestions.appendChild(div);
                    }
                }
            }
        }

        document.getElementById('searchForm').addEventListener('submit', search);
    </script>
</body>
</html>
